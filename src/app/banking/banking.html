<section class="p-4">
  <!-- ===== HEADER GIỐNG PAYMENT ===== -->
  <div class="d-flex align-items-center justify-content-between mb-3 header-bar">
    <div class="d-flex align-items-center">
      <i
        class="bi bi-box-arrow-left"
        style="cursor: pointer; font-size: 1.05rem; margin-right: 0.75rem"
        (click)="navigateBack()"
      ></i>
      <div>
        <div class="h-100 d-flex align-items-center">
          <h2 class="m-0">Đặt phòng</h2>
        </div>
      </div>
    </div>

    <div class="d-flex align-items-center steps">
      <ng-container *ngFor="let s of headerSteps">
        <div class="d-flex align-items-center me-3">
          <div class="step-circle me-2" [ngClass]="{ active: s.id === currentStep }">
            {{ s.id }}
          </div>
          <div class="small text-muted" [ngClass]="{ 'text-primary': s.id === currentStep }">
            {{ s.name }}
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- ===== NỘI DUNG CHÍNH TRANG BANKING ===== -->
  <div class="container mt-4 qr-container">
    <div class="row">
      <!-- ===== CỘT TRÁI: QR THANH TOÁN ===== -->
      <div class="col-md-7 qr-left">
        <div class="qr-box-wrapper">
          <div class="alert alert-primary text-center mb-3">
            Chúng tôi đang giữ phòng này cho bạn! Hãy hoàn tất thanh toán trong
            <strong class="text-success">{{ timeLeft }}</strong>
          </div>

          <h4 class="mb-2 text-center">Quét mã QR để thanh toán</h4>

          <div class="alert alert-warning py-2 small">
            Vui lòng hoàn tất thanh toán trước thời gian quy định.<br />
            Nếu không, giao dịch sẽ được tự động hoàn trả trong vòng 10 ngày làm việc.
          </div>

          <div class="qr-box p-3 rounded">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <img src="assets/vietqr.png" alt="VietQR" height="22" />
              <button class="btn btn-outline-primary btn-sm" (click)="downloadQR()">
                Tải về mã QR
              </button>
            </div>

            <div class="text-center mb-3">
              <h5 class="fw-bold">{{ merchantName }}</h5>
              <img [src]="qrCodeUrl" alt="QR Code thanh toán" class="qr-image" />
              <div class="text-muted small mt-2">
                Thanh toán trước:
                <strong>{{ expiredAt | date: 'HH:mm, dd/MM/yyyy' }}</strong>
              </div>
            </div>
          </div>

          <h5 class="mt-4">Hướng dẫn thanh toán QR</h5>
          <div class="instructions p-3 rounded">
            <ol class="mb-0">
              <li>
                Mở ví điện tử hoặc ứng dụng ngân hàng hỗ trợ VietQR, sau đó quét mã QR bên trên.
              </li>
              <li>
                Đảm bảo số tiền và nội dung thanh toán khớp với đơn hàng, sau đó hoàn tất giao dịch.
              </li>
              <li>
                Đơn đặt chỗ sẽ được xác nhận tự động sau khi thanh toán thành công.
              </li>
            </ol>
          </div>
        </div>
      </div>

      <!-- ===== CỘT PHẢI: THÔNG TIN ĐẶT CHỖ ===== -->
      <div class="col-md-5">
        <div class="summary-box">
          <h5 class="mb-3">
            <i class="bi bi-receipt text-primary me-2"></i> Thông tin đặt chỗ
          </h5>

          <!-- ✅ Thông tin khách hàng -->
          <p><strong>Khách hàng:</strong> {{ customer?.fullName }}</p>
          <p><strong>Email:</strong> {{ customer?.email }}</p>
          <p><strong>Số điện thoại:</strong> {{ customer?.phone }}</p>

          <hr />

          <!-- ✅ Thông tin phòng -->
          <p><strong>Phòng:</strong> {{ booking?.room?.name }}</p>
<p><strong>Số lượng:</strong> {{ booking?.room?.capacity || booking?.range }}</p>

<!-- ✅ Hiển thị giá phòng (theo giờ hoặc theo đơn vị) -->
<p *ngIf="roomPrice > 0">
  <strong>Giá phòng:</strong>
  <span> {{ roomPrice | number }} VND</span>
</p>


          <!-- ✅ Hiển thị ngày (giống Payment) -->
          <p><strong>Ngày:</strong> {{ bookingDate }}</p>
          <p><strong>Giờ nhận:</strong> {{ checkInTime }}</p>
          <p><strong>Giờ trả:</strong> {{ checkOutTime }}</p>


          <hr />

          <!-- ✅ Dịch vụ đi kèm -->
          <p class="fw-bold mb-2">
            Dịch vụ đi kèm:
            <span *ngIf="!booking?.services || booking?.services.length === 0" class="text-muted fw-normal">
              Không có dịch vụ kèm theo
            </span>
          </p>

          <ul class="list-unstyled ms-3" *ngIf="booking?.services?.length > 0">
            <li *ngFor="let s of booking.services">
              {{ s.name }} - {{ s.price | number }} VND
            </li>
          </ul>

          <hr />

          <!-- ✅ Tổng tiền -->
         <div class="text-end">
  <p class="mb-1"><strong class="text-muted">Tổng cộng:</strong></p>

  <!-- Hiển thị giá gốc nếu có voucher -->
  <div *ngIf="originalPrice > totalPrice" class="text-muted small" style="text-decoration: line-through;">
    {{ originalPrice | number }} VND
  </div>

  <!-- Hiển thị giá đã giảm -->
  <h4 class="text-primary fw-bold">
    {{ totalPrice | number }} VND
  </h4>
</div>


          <!-- ✅ PHẦN KIẾM XU (giống Payment) -->
          <div class="rewards-row mt-3 d-flex align-items-center gap-2">
            <span
              class="icon rounded-circle d-inline-flex align-items-center justify-content-center"
              style="background:#fff6e6; width:28px; height:28px;"
            >
              <i class="bi bi-coin text-warning" style="font-size:1rem;"></i>
            </span>
            <strong style="color: #a66b00;">Kiếm {{ rewardPoints | number }} Xu</strong>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
