<div class="page">
  <!-- üîπ Ti√™u ƒë·ªÅ ch√≠nh -->

  <!-- üîπ ƒêi·ªÉm hi·ªán t·∫°i v√† B·ªô l·ªçc (G·ªôp chung) -->
  <div class="top-section">
    <!-- ƒêi·ªÉm hi·ªán t·∫°i -->
    <div class="points-card-compact">
      <div class="points-content-compact">
        <div class="points-icon-compact">
          <i class="bi bi-coin"></i>
        </div>
        <div class="points-info-compact">
          <p class="points-label-compact">S·ªë ƒëi·ªÉm hi·ªán c√≥</p>
          <h3 class="points-value-compact">
            <span>{{ userPoints | number }}</span>
            <span class="points-unit-compact">Xu</span>
          </h3>
        </div>
      </div>
    </div>

    <!-- üîπ B·ªô l·ªçc v√† t√¨m ki·∫øm -->
    <div class="filter-section-compact">
      <!-- H√†ng 1: Search + Category Tabs -->
      <div class="filter-row-top">
        <!-- Search Box -->
        <div class="search-box-compact">
          <i class="bi bi-search"></i>
          <input 
            type="text" 
            [(ngModel)]="searchQuery" 
            (input)="onSearch()"
            (keydown.enter)="onSearch()"
            placeholder="T√¨m ki·∫øm..."
            class="search-input-compact"
          />
          <button 
            type="button"
            class="btn-clear-search-compact" 
            *ngIf="searchQuery" 
            (click)="clearSearch()"
            title="X√≥a t√¨m ki·∫øm">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        
        <!-- Category Tabs -->
        <div class="category-tabs-compact">
          <button 
            class="tab-btn-compact" 
            [class.active]="selectedCategory === 'all'"
            (click)="changeCategory('all')">
            <i class="bi bi-grid"></i> T·∫•t c·∫£
          </button>
          <button 
            class="tab-btn-compact" 
            [class.active]="selectedCategory === 'voucher'"
            (click)="changeCategory('voucher')">
            <i class="bi bi-ticket-perforated"></i> Voucher
          </button>
          <button 
            class="tab-btn-compact" 
            [class.active]="selectedCategory === 'item'"
            (click)="changeCategory('item')">
            <i class="bi bi-gift"></i> V·∫≠t ph·∫©m
          </button>
        </div>
      </div>
      
      <!-- H√†ng 2: Filter Group -->
      <div class="filter-row-bottom">
        <div class="filter-group">
          <div class="filter-group-header">
            <i class="bi bi-funnel"></i>
            <span>B·ªô l·ªçc</span>
          </div>
          <div class="filter-group-content">
            <!-- S·∫Øp x·∫øp theo ƒëi·ªÉm -->
            <div class="filter-item">
              <i class="bi bi-coin"></i>
              <select [(ngModel)]="pointsSort" (change)="changePointsSort(pointsSort)" class="filter-select">
                <option value="none">S·∫Øp x·∫øp ƒëi·ªÉm</option>
                <option value="low">ƒêi·ªÉm: Th·∫•p ‚Üí Cao</option>
                <option value="high">ƒêi·ªÉm: Cao ‚Üí Th·∫•p</option>
              </select>
            </div>
            <div class="filter-divider"></div>
            <!-- S·∫Øp x·∫øp theo t√™n -->
            <div class="filter-item">
              <i class="bi bi-sort-alpha-down"></i>
              <select [(ngModel)]="nameSort" (change)="changeNameSort(nameSort)" class="filter-select">
                <option value="none">S·∫Øp x·∫øp t√™n</option>
                <option value="asc">T√™n: A ‚Üí Z</option>
                <option value="desc">T√™n: Z ‚Üí A</option>
              </select>
            </div>
            <div class="filter-divider"></div>
            <!-- L·ªçc theo ƒëi·ªÉm -->
            <div class="filter-item">
              <i class="bi bi-funnel-fill"></i>
              <select [(ngModel)]="pointsFilter" (change)="changePointsFilter(pointsFilter)" class="filter-select">
                <option value="all">T·∫•t c·∫£ ƒëi·ªÉm</option>
                <option value="0-200">0-200 Xu</option>
                <option value="200-400">200-400 Xu</option>
                <option value="400-600">400-600 Xu</option>
                <option value="600+">600+ Xu</option>
              </select>
            </div>
          </div>
          <!-- N√∫t x√≥a b·ªô l·ªçc -->
          <button class="btn-clear-filters" (click)="clearFilters()" title="X√≥a t·∫•t c·∫£ b·ªô l·ªçc">
            X√≥a
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- üîπ Khu v·ª±c voucher -->
  <h2 class="section-title" *ngIf="selectedCategory === 'all' || selectedCategory === 'voucher'">
    <i class="bi bi-ticket-perforated"></i> Danh s√°ch Voucher
    <span class="count-badge" *ngIf="filteredVouchers.length !== vouchers.length">
      ({{ filteredVouchers.length }}/{{ vouchers.length }})
    </span>
  </h2>
  <div class="no-results" *ngIf="(selectedCategory === 'all' || selectedCategory === 'voucher') && filteredVouchers.length === 0">
    <i class="bi bi-inbox"></i>
    <p>Kh√¥ng t√¨m th·∫•y voucher n√†o</p>
  </div>
  <div class="voucher-grid" *ngIf="(selectedCategory === 'all' || selectedCategory === 'voucher') && filteredVouchers.length > 0">
    <div class="voucher-card" *ngFor="let v of filteredVouchers; let i = index">
      <div class="voucher-image-wrapper">
        <img [src]="v.img" alt="Voucher" class="voucher-img" (error)="handleImageError($event)" />
        <div class="image-overlay">
          <button class="btn-change-image" (click)="changeVoucherImage(getVoucherIndex(v))" title="Thay ƒë·ªïi h√¨nh ·∫£nh">
            <i class="bi bi-image"></i>
          </button>
        </div>
        <input 
          type="file" 
          [id]="'voucher-image-' + getVoucherIndex(v)" 
          accept="image/*" 
          style="display: none;"
          (change)="onVoucherImageChange($event, getVoucherIndex(v))"
        />
      </div>
      <div class="voucher-body text-center">
        <h4 class="card-title">{{ v.type }}</h4>
        <p class="points-required">
          <i class="bi bi-coin"></i> C·∫ßn: <b>{{ v.pointsRequired | number }}</b> Xu
        </p>
        <button class="btn btn-redeem" (click)="redeemVoucher(v)">
          <i class="bi bi-ticket-perforated"></i> ƒê·ªïi ngay
        </button>
      </div>
    </div>
  </div>

  <!-- üîπ Khu v·ª±c v·∫≠t ph·∫©m -->
  <h2 class="section-title" *ngIf="selectedCategory === 'all' || selectedCategory === 'item'">
    <i class="bi bi-gift"></i> Danh s√°ch V·∫≠t ph·∫©m
    <span class="count-badge" *ngIf="filteredItems.length !== items.length">
      ({{ filteredItems.length }}/{{ items.length }})
    </span>
  </h2>
  <div class="no-results" *ngIf="(selectedCategory === 'all' || selectedCategory === 'item') && filteredItems.length === 0">
    <i class="bi bi-inbox"></i>
    <p>Kh√¥ng t√¨m th·∫•y v·∫≠t ph·∫©m n√†o</p>
  </div>
  <div class="item-grid" *ngIf="(selectedCategory === 'all' || selectedCategory === 'item') && filteredItems.length > 0">
    <div class="item-card" *ngFor="let i of filteredItems; let idx = index">
      <div class="item-image-wrapper">
        <img [src]="i.img" alt="Item" class="item-img" (error)="handleImageError($event)" />
        <div class="image-overlay">
          <button class="btn-change-image" (click)="changeItemImage(getItemIndex(i))" title="Thay ƒë·ªïi h√¨nh ·∫£nh">
            <i class="bi bi-image"></i>
          </button>
        </div>
        <input 
          type="file" 
          [id]="'item-image-' + getItemIndex(i)" 
          accept="image/*" 
          style="display: none;"
          (change)="onItemImageChange($event, getItemIndex(i))"
        />
      </div>
      <div class="item-info text-center">
        <h4 class="card-title">{{ i.name }}</h4>
        <p class="points-required">
          <i class="bi bi-coin"></i> C·∫ßn: <b>{{ i.pointsRequired | number }}</b> Xu
        </p>
        <button class="btn btn-redeem" (click)="redeemItem(i)">
          <i class="bi bi-box-seam"></i> ƒê·ªïi ngay
        </button>
      </div>
    </div>
  </div>

  <!-- üîπ Footer -->
  <div class="footer-note">
    <p><i class="bi bi-info-circle"></i> L∆∞u √Ω: ƒêi·ªÉm sau khi ƒë·ªïi s·∫Ω kh√¥ng th·ªÉ ho√†n l·∫°i.</p>
    <p class="copyright">¬© 2025 ƒê·ªïi qu√† th√†nh vi√™n Panacea</p>
  </div>
</div>
