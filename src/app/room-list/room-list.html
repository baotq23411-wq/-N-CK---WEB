<div class="header py-4">
  <div class="container">
    <div class="search-widget shadow p-4 rounded-4">
      <form class="row g-3 align-items-center justify-content-center" (ngSubmit)="onSearchRooms()">

        <!-- Thanh tìm kiếm -->
        <div class="col-md-4">
          <label for="location" class="form-label fw-semibold">Tìm theo từ khóa:</label>
          <input type="text"
                 id="location"
                 name="keywordInput"
                 class="form-control"
                 [(ngModel)]="keywordInput"
                 placeholder="Nhập từ khóa: Oasis, thư giãn, healing..."
                 required />
        </div>

        <!-- Ngày đến -->
        <div class="col-md-3">
          <label for="checkin" class="form-label fw-semibold">Ngày đến:</label>
          <input type="date"
                id="checkin"
                name="checkinDate" 
                class="form-control"
                [(ngModel)]="checkinDate"
                required />
        </div>


        <!-- Nút tìm kiếm -->
        <div class="col-md-2 d-flex align-self-end">
          <button type="submit" 
                  class="btn btn-outline-warning w-100 h-100">
            <i class="bi bi-search"></i> 
          Tìm phòng
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="container mt-4">
  <div class="row">

    <!-- BỘ LỌC BÊN TRÁI -->
    <div class="col-md-3">
      <div class="filter-panel">
        <div class="filter-title d-flex align-items-center gap-2 mb-3">  
        <h5 class="fw-bold m-0">Bộ lọc:</h5>
        <i class="bi bi-sliders2-vertical fs-5 text-primary ms-auto" title="Tuỳ chỉnh bộ lọc"></i>
      </div>

        <!-- KHUNG 1: LỌC THEO GIÁ -->
        <div class="filter-section p-3 rounded-4 shadow-sm">
          <div class="filter-header d-flex justify-content-between align-items-center mb-2">
            <span class="fw-semibold"><i class="bi bi-cash-coin me-1 text-primary"></i>Khoảng giá</span>
            <a href="#" (click)="resetPrice()" class="text-decoration-none small text-primary">Đặt lại</a>
          </div>

          <div class="d-flex align-items-center gap-2 mb-1">
            <input type="number"
                  class="form-control form-control-sm"
                  [(ngModel)]="selectedMinPrice"
                  [min]="minPrice"
                  [max]="selectedMaxPrice"
                  placeholder="Từ" />
            <span class="fw-bold">–</span>
            <input type="number"
                  class="form-control form-control-sm"
                  [(ngModel)]="selectedMaxPrice"
                  [min]="selectedMinPrice"
                  [max]="maxPrice"
                  placeholder="Đến" />
          </div>

          <div class="d-flex justify-content-between small text-muted mb-2">
            <span>{{ formatCurrency(selectedMinPrice) }}</span>
            <span>{{ formatCurrency(selectedMaxPrice) }}</span>
          </div>

          <hr>

          <div class="filter-header mb-1"><i class="bi bi-sort-down-alt me-1 text-primary"></i>Sắp xếp theo</div>
          <select class="form-select form-select-sm mb-2" [(ngModel)]="sortOrder" (change)="onFilterRooms()">
            <option value="">-- Không sắp xếp --</option>
            <option value="asc">Giá tăng dần</option>
            <option value="desc">Giá giảm dần</option>
          </select>

          <button class="btn btn-outline-primary btn-sm w-100 d-flex align-items-center justify-content-center gap-2"
                  (click)="onFilterRooms()">
            <i class="bi bi-funnel"></i> Áp dụng lọc giá
          </button>
        </div>

        <!-- KHUNG 2: LỌC THEO KHU VƯỜN -->
        <div class="filter-section">
          <div class="filter-header bi bi-tree"> Khu vườn</div>
          <div class="form-check">
            <input class="form-check-input"
                  type="checkbox"
                  [checked]="isAllGardensSelected()"
                  (change)="toggleAllGardens($event)" />
            <label class="form-check-label fw-semibold">Chọn tất cả</label>
          </div>

          <div *ngFor="let garden of gardenTags">
            <div class="form-check">
              <input class="form-check-input"
                    type="checkbox"
                    [checked]="selectedGardens.includes(garden)"
                    (change)="toggleGarden(garden)" />
              <label class="form-check-label">{{ garden }}</label>
            </div>
          </div>
        </div>

        <!-- KHUNG 3: LỌC THEO SỨC CHỨA -->
        <div class="filter-section">
          <div class="filter-header bi bi-people"> Sức chứa tối đa</div>
          <select class="form-select"
                  [(ngModel)]="guestCountFilter"
                  (change)="onFilterRooms()">
            <option value="">Tất cả</option>
            <option value="2">2 người</option>
            <option value="5">5 người</option>
            <option value="10">10 người</option>
          </select>
        </div>

        <!-- KHUNG 4: LOẠI HÌNH KHÔNG GIAN -->
        <div class="filter-section">
          <div class="filter-header d-flex justify-content-between bi bi-boxes">
            <span>Loại hình không gian</span>
            <button class="btn btn-link p-0" 
                    (click)="toggleShowAllSpaceTags()"
                    style="font-size: 13px;">
              {{ showAllSpaceTags ? 'Thu gọn' : 'Xem tất cả' }}
            </button>
          </div>

          <div *ngFor="let tag of visibleSpaceTags">
            <div class="form-check">
              <input class="form-check-input"
                     type="checkbox"
                     [checked]="selectedSpaceTags.includes(tag)"
                     (change)="toggleSpaceTag(tag)" />
              <label class="form-check-label">{{ tag }}</label>
            </div>
          </div>
        </div>

      </div>
    </div>

  <!-- CỘT BÊN PHẢI -->
  <div class="col-md-9">

    <!-- Đánh dấu vị trí cuộn tới -->
    <div class="room-list-results"></div>

    <!-- Nút xem ngang/dọc -->
    <div class="d-flex justify-content-end mb-3">
      <div class="btn-group" role="group">
        <button class="btn btn-outline-primary"
                [class.active]="viewMode === 'horizontal'"
                (click)="setViewMode('horizontal')">
          <i class="bi bi-grid-3x3-gap"></i> Xem ngang
        </button>
        <button class="btn btn-outline-primary"
                [class.active]="viewMode === 'vertical'"
                (click)="setViewMode('vertical')">
          <i class="bi bi-list-ul"></i> Xem dọc
        </button>
      </div>
    </div>

    <!-- XEM DỌC -->
    <div *ngIf="viewMode === 'vertical'" class="d-flex flex-column gap-4">
      <div *ngFor="let pkg of allPackages" 
            class="d-flex border rounded overflow-hidden shadow-sm p-3 room-card"  
            (click)="goToRoomDetail(pkg.room_id)">
        <!-- Ảnh -->
        <div class="image-wrapper">
          <img [src]="pkg.image"
              alt="{{ pkg.room_name }}"
              style="width: 200px; height: 150px; object-fit: cover;">
        </div>

        <!-- Thông tin -->
        <div class="p-3 flex-grow-1">
          <h5 class="fw-bold text-primary mb-2">{{ pkg.room_name }}</h5>
          <p class="mb-1"><strong>Gói:</strong> {{ pkg.range }}</p>
          <p class="text-muted small">{{ pkg.description }}</p>

          <div class="d-flex flex-wrap gap-1">
            <span *ngFor="let tag of pkg.tags" class="badge bg-secondary">{{ tag }}</span>
          </div>
        </div>

        <!-- Giá -->
        <div class="text-end d-flex flex-column justify-content-between align-items-end" style="min-width: 180px;">
          <div>
            <div class="text-danger fw-bold fs-5">{{ pkg.price | number }} VND</div>
            <small class="text-muted">Chưa gồm thuế & phí</small>
          </div>
          <button class="btn btn-warning mt-2" (click)="goToRoomDetail(pkg.room_id)">Chọn gói</button>
        </div>
      </div>

      <div *ngIf="allPackages.length === 0" class="text-muted text-center">
        Không tìm thấy gói phù hợp.
      </div>
    </div>

    <!-- XEM NGANG (GRID 3 CỘT) -->
    <div *ngIf="viewMode === 'horizontal'" 
          class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
      <div *ngFor="let pkg of allPackages" class="col">
        <div class="card h-100 shadow-sm room-card"
             (click)="goToRoomDetail(pkg.room_id)">
          <img [src]="pkg.image" 
               class="card-img-top" 
               [alt]="pkg.room_name" 
               style="height: 150px; object-fit: cover;">
          <div class="card-body d-flex flex-column justify-content-between">
            <h5 class="card-title text-primary">{{ pkg.room_name }}</h5>
            <p class="card-text"><strong>Gói:</strong> {{ pkg.range }}</p>
            <p class="card-text text-muted small">{{ pkg.description }}</p>

            <div class="mb-2">
              <span *ngFor="let tag of pkg.tags" 
                     class="badge bg-secondary me-1">
                {{ tag }}
              </span>
            </div>

            <div class="mt-auto">
              <div class="fw-bold text-danger mb-1">{{ pkg.price | number }} VND</div>
              <small class="text-muted">Chưa gồm thuế & phí</small>
              <button class="btn btn-warning w-100 mt-2">Chọn gói</button>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="allPackages.length === 0" class="text-muted text-center">
        Không tìm thấy gói phù hợp.
      </div>
    </div>

  </div>

</div>



